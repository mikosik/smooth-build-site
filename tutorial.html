<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="description" content="Smooth-build : powerful build tool with simple language" />
    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">
    <title>Smooth-build</title>

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-44171036-1', 'smooth-build.org');
      ga('send', 'pageview');
    </script>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="blog_banner" href="http://smooth-build.blogspot.com">blog</a>
          <a id="download_banner" href="download.html">download</a>
          <a id="sourcecode_banner" href="https://github.com/mikosik/smooth-build">source code</a>
          <a id="donate_banner" href="donate.html">donate</a>

          <h1 id="project_title"><a class="white_link" href="index.html">Smooth-build</a></h1>
          <h2 id="project_tagline">powerful build tool with simple language</h2>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner" style="text-align: justify;">
        <h3>Smooth tutorial</h3>
        <h4>What is Smooth-build</h4>
        <p>
           Smooth-build is a build automation tool (and its simple yet expressive language).
        </p>
        <p>
           Building jar file with java application can be done in one line of Smooth code:
        </p>
        <p>
<pre><code>
release.jar: <a href="api/smooth/file/files.html">files</a>("src") | <a href="api/smooth/java/javac.html">javac</a> | <a href="api/smooth/java/jar.html">jar</a> ;

</code></pre>
        </p>
           Once Smooth development reaches version 1.0 it will allow robust multithreading execution (possibly on multiple machines) of your build process without any extra configuration on your side.
        </p>

        <h4>Prerequisites</h4>
        <p>Learning is much faster when you can experiment on the way. Therefore it is advised to install Smooth-build by following <a class="visible_link" href="download.html">download / install</a> documentation so you can try all examples from this tutorial yourself.</p>

        </p>All examples used in this tutorial are available online as <a class="visible_link" href="https://github.com/mikosik/smooth-build-examples">smooth-build-examples</a> github project. You can checkout it as a git repository:
        <p>
<pre><code>
git clone https://github.com/mikosik/smooth-build-examples.git

</code></pre>
        </p>
        <p>or download <a class="visible_link" href="https://github.com/mikosik/smooth-build-examples/archive/master.zip">master.zip</a> file if you do not have git installed.</p>
        
        <h4>Running build</h4>  
        <p>Smooth uses "build.smooth" file located in your project's root directory as a description of project's build process. If you downloaded smooth-build-examples, note that it contains many exampleXX directories. Each is a separate project so each contains single "build.smooth" file.
        </p>
        <p>
        To run build process enter directory "example01" and type "smooth build release.jar" (on Linux) or "smooth.bat build release.jar" (on Windows). If you installed smooth correctly and added it to your system PATH as advised by <a class="visible_link" href="download.html"> download / install</a> you should get smooth running successfully with output equal to the one below:
        </p>
        <p>
<pre><code>$smooth build release.jar
 + files                                           [ line 2 ]
 + javac                                           [ line 2 ]
 + jar                                             [ line 2 ]
 + save                                            [ line 2 ]
 + SUCCESS :)
$
</code></pre>
        </p>

        <h4>Function calls</h4>
        </p>
Now let's take a look at build file we've just run from our first example (<a class="visible_link" href="https://github.com/mikosik/smooth-build-examples/tree/master/example01">example01</a>). Note you can click function names in each example to see detailed API documentation.
        </p>
        <p>
<pre><code>
release.jar: <a href="api/smooth/file/files.html">files</a>("src") | <a href="api/smooth/java/javac.html">javac</a> | <a href="api/smooth/java/jar.html">jar</a> ;

</code></pre>
        </p>
        <p>
        If you happen to know how pipes work in Linux shells it will be clear to you what this script does. It defines "release.jar" function that performs following tasks:
        <ul>
          <li>takes all files (recursively) from "src" directory</li>
          <li>passes them to <a href="api/smooth/java/javac.html">javac</a> function (Java compiler) that compiles them</li>
          <li>passes result of <a href="api/smooth/java/javac.html">javac</a> call (*.class files) to <a href="api/smooth/java/jar.html">jar</a> function that packs them into single jar file</li>
        </ul>
        </p>
        <p>Note that you don't need to explicitly create directory for *.class files nor even mention it in build file. Smooth handles that automatically. All final results are stored inside ".smooth/results" directory. In that particular example file "release.jar" is created.</p>


        <h4>Caching</h4>

        <p>
        Before we move to more advanced stuff it's worth to mention how result caching works in smooth.
        If you happened to run build command twice in previous example you should notice interesting thing.
        Most of lines in output have 'CACHE' word appended. This means those task were not calculated in this
        run but their results were taken from cache that keeps all results calculated so far.
        </p>

        <p>
<pre><code>$smooth build release.jar
 + files                                           [ line 2 ]
 + javac                                           [ line 2 ] CACHE
 + jar                                             [ line 2 ] CACHE
 + save                                            [ line 2 ]
 + SUCCESS :)
$
</code></pre>
        </p>

        <p>
        It may seem obvious so far. Most build system reuses results from previous builds via so called incremental building.
        Although it speeds things up, it also creates its own problems. For example if you happen to delete one of your *.java files you have to 
        remember to do so called "clean" to remove *.class file that was generated by previous run for that build.
        Another thing is that icremental building remembers output only from last execution of the build process.
        </p>

        <p>
        Smooth is much smarter. For each task it has ever executed, it stores result and content digest of task's arguments
        (<a class="visible_link" href="http://en.wikipedia.org/wiki/SHA-1">sha1</a> is used for that).
        If it ever has to execute given function with the same arguments it just takes result from cache. So it doesn't just store result of last build.
        It has cache of all results you have ever calculated on your machine.
        </p>
        <p>
        Let's understand advantages of that solution.
        Let's change one of java files in example01 project (for example src/KnightsWhoSayNi.java)
        by just adding a few empty spaces at the end of one line.
        When you run build again you notice that javac task has to be executed once again (as content of *.java files has changed) but because
        you changed only formatting of the file, compilation will produce exactly the same *.class file as before.
        When smooth tries to jar that file it will realize it has result of such execution in its cache and will simply return it.
        Note that such optimization is never possible with incremental building as change to any file at the beginning of the build pipeline
        will always force rebuild of all tasks that depend on it.
        </p>

        <p>
<pre><code>$smooth build release.jar
 + files                                           [ line 2 ]
 + javac                                           [ line 2 ]
 + jar                                             [ line 2 ] CACHE
 + save                                            [ line 2 ]
 + SUCCESS :)
$
</code></pre>
        </p>
        <p>
        Now if you revert changes you introduced to mentioned java file and run build once more then all task's result will be taken from 
        cache.
        </p>


        <h4>Type system</h4>
        <p>
	We've seen that function can accept and return values which we called 'files' so far. It is time to define all types that can be accepted and returned by Smooth function. As of latest release there are two basic types and two compound types:
        <dl>
          <dt>String</dt>
          <dd>Sequence of characters.</dd>
          <dt>String*</dt>
          <dd>Collection of Strings.</dd>
          <dt>File</dt>
          <dd>Single file read from file system. Each File has a content and path associated with it.</dd>
          <dt>File*</dt>
          <dd>Collection of Files. It will never contain two files which have the same path.</dd>
        </dl>
        There are obviously some important types (like boolean) missing. Remember this is very early version of Smooth-build tool.
        </p>
        <p>
        Smooth is statically typed. Each function declares its parameters and their types. Build process will fail in initial stage if argument passed to a function call won't match required types.
        </p>
        
        <h4>Nested function calls</h4>
        <p>Let's dig a little bit deeper into functions chaining. Chaining function calls via pipes that we've seen in the very first example is just a syntactic sugar over more traditional function calls. Let's take a look at <a class="visible_link" href="https://github.com/mikosik/smooth-build-examples/tree/master/example02">example02</a> that declares the same process but without using pipes.
        <p>
<pre><code>
release.jar: <a href="api/smooth/java/jar.html">jar</a>(<a href="api/smooth/java/javac.html">javac</a>(<a href="api/smooth/file/files.html">files</a>("src")));

</code></pre>
        </p>
        <p>
        Now it looks like friendly if you come from world of imperative languages.
        </p>
        <p>As you could probably noticed version using pipes is much more readable. The flow of data through different functions is much more visible. You should always strive to use pipes version.</p>

        <h4>Named parameters</h4>
        <p>
          If you take a look at our last example and check documentation for <a href="api/smooth/file/save.html">save</a> function you notice that we passed only two arguments to it while documentation for that function specifies three. Smooth does not require you to specify values for all parameters nor it requires to pass them in any order. Smooth intelligently deduces which parameter should be assigned from which argument based on their types. If there is ambiguity (for example two parameters have the same type as passed argument) matching will fail unless we explicitly assign ambiguous arguments to parameters or one of parameters is required in which case it will be assigned as it is the only option to make whole function call correct.
        </p>
        <p>
        Let's look at <a class="visible_link" href="https://github.com/mikosik/smooth-build-examples/tree/master/example03">example03</a>. It explicitly assigns arguments to parameters (although it is not necessary in that case as automatic assignment would work fine).
        </p>
        <p>
<pre><code>
release.jar: <a href="api/smooth/java/jar.html">jar</a>(files=<a href="api/smooth/java/javac.html">javac</a>(sources=<a href="api/smooth/file/files.html">files</a>(dir="src")));

</code></pre>
        </p>
        <p>
          Note that explicitly assigning argument to parameter cannot be done for value that is passed through a pipe. This may be a nuisanance as you have to use nested function calls in such cases.
        </p>
        <p>
          In most cases you probably use named arguments even though they are not required just to increase readability of your code. Skipping naming makes sense in common functions like <a class="visible_link" href="api/smooth/file/save.html">save</a> or <a class="visible_link" href="api/smooth/file/file.html">file</a> when assignment that will be chosen automatically is obvious to the human reader.
        </p>
	<h4>Literals</h4>
        As you noticed Smooth contains String literals as any other language. Another literal that you find useful is a collection literal that lets you create File* and String* collections. Collection literal is comma separated list of expressions enclosed inside brackets []. <a class="visible_link" href="https://github.com/mikosik/smooth-build-examples/tree/master/example04">Example04</a> below shows collection literal in action. Note that this time our (user defined) function "zipped" calls other function defined by us "books".
        <p>
<pre><code>
books: [ <a href="api/smooth/file/file.html">file</a>("books/LifeOfBrian.txt"), <a href="api/smooth/file/file.html">file</a>("books/TheMeaningOfLife.txt") ];
zipped: books | <a href="api/smooth/compress/zip.html">zip</a> | <a href="api/smooth/file.save.html">save("output")</a>;

</code></pre>
        </p>

        <h4>Advanced example</h4>
        Let's do something more complicated. Take a look at <a class="visible_link" href="https://github.com/mikosik/smooth-build-examples/tree/master/example05">Example05</a>.
<p>
<pre><code>
library: <a href="api/smooth/file/files.html">files</a>("src/lib") | <a href="api/smooth/java/javac.html">javac</a> | <a href="api/smooth/java/jar.html">jar</a>;
release.jar: <a href="api/smooth/file/files.html">files</a>("src/main") | <a href="api/smooth/java/javac.html">javac</a>(libs=[library]) | <a href="api/smooth/java/jar.html">jar</a> ;

</code></pre>
        </p>
        <p>
        First line defines library - it takes java files from "src/lib" dir, compiles them and packs as jar file.
        Second line does similar thing to java files from "src/main" dir but it uses jar produces by the first line.
        </p>
        <p>
        Once again, notice that we didn't have to specify (nor create) any directory for temporary files. Only location of java source files and output directory had to be provided.
        </p>

        <h4>More to come</h4>
        <p>
        This is only beginning of Smooth-build development so there's a lot of features that can be done to revolutionize the world of application building. Take a look at <a class="visible_link" href="roadmap.html">Feature roadmap</a> to see what is coming.
        </p>

      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p><a class="white_link" href="https://groups.google.com/forum/#!forum/smooth-build">discussion group</a> | <a class="white_link" href="https://github.com/mikosik/smooth-build/issues/new">report issue</a></p>
      </footer>
    </div>

  </body>
</html>
